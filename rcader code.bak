#lang racket
(require r-cade)
(require racket/match)

(define jump (action btn-select))
(define talking (action btn-z #t))
(define drawing (action btn-x #t))

(define boop (sweep 440   ; start frequency
                    300   ; end frequency
                    0.1   ; duration
                    (voice sawtooth-wave z-envelope)))

(define theme
  (music "E4-B3C4D-CB3A-AC4E-DCB3-C4D-E-C-A3-A-.D4-FA-GFE-CE-DCB3-BC4D-E-C-A3-A-."
         #:tempo 280))

(define (do-boop)
  (btn-start #t 3))

(define (random-color x)
  (cond
    [(>= x 17) 0]
    [(< x 17) (+ x 1)]))

(define i 0)

(define (game-loop)
  (cls)

  (when (jump)
    (text 2 2 "jumped!"))

  (when (talking)
    (text 2 6 "blablabla..."))

  (when (drawing)
    (set! i (random-color i))
    (let ([x (mouse-x)]
         [y (mouse-y)])
    (color i)
    (draw x y '(#b01100110
                #b11111111
                #b11111111
                #b01111110
                #b00111100
                #b00011000))))
  
   (when (do-boop)
    (play-sound boop)))

  (define (start-music)
    (play-music theme))

(run game-loop 256 128)


